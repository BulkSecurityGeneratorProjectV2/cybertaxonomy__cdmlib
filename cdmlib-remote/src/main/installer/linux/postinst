#!/bin/sh
# postinst script for cdmserver
#
# see: dh_installdeb(1)

set -e

#variables
CDM_HOME="/opt/cdmserver/"
CDM_LIBRARY=$CDM_HOME".cdmLibrary"
CDM_LOG="/var/log/cdmserver/"
bindir="/etc/init.d/"
TMP="/usr/bin/"

SERVERSCRIPT="cdmserver"
SERVERJAR="cdmserver-standalone.jar"
SERVERCONF="datasources.xml"

CDM_USER=root
CDM_GROUP=root
USER=$(grep $CDM_USER /etc/passwd)
GROUP=$(grep $CDM_GROUP /etc/passwd)
#echo user : $USER 
#echo group : $GROUP
# summary of how this script can be called:
#        * <postinst> `configure' <most-recently-configured-version>
#        * <old-postinst> `abort-upgrade' <new version>
#        * <conflictor's-postinst> `abort-remove' `in-favour' <package>
#          <new-version>
#        * <postinst> `abort-remove'
#        * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
#          <failed-install-package> <version> `removing'
#          <conflicting-package> <version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package


case "$1" in
    configure)
    
    #creating a new user and group
 #   echo TESTING!!!!
 #   if [ -n "$GROUP" ]
 #   then
 #   echo GROUP EXISTS!!!!
 #   groupdel $CDM_GROUP
 #   fi
 #   groupadd $CDM_GROUP
 #
 #   if [ -n "$USER" ]
 #   then
 #   echo USER EXITS!!!!
 #   userdel $CDM_USER
 #   fi
 #   useradd -g $CDM_GROUP $CDM_USER

    #installing the script
    cp $TMP$SERVERSCRIPT $bindir
    chmod 755 $bindir$SERVERSCRIPT
    chown $CDM_USER:$CDM_GROUP $bindir$SERVERSCRIPT
    update-rc.d $SERVERSCRIPT defaults 98 02

    #creating the directories
    mkdir -p $CDM_HOME
    mkdir -p $CDM_LIBRARY
    mkdir -p $CDM_LOG

    #installing the server and the configfile
    cp $TMP$SERVERCONF $CDM_LIBRARY
    cp $TMP$SERVERJAR $CDM_HOME

    #starting the script
    $bindir$SERVERSCRIPT start


    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0


