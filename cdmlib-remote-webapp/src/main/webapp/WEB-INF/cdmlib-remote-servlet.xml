<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
    ">
  <context:component-scan base-package="eu/etaxonomy/cdm/remote" />


  <!--
    ======= HandlerMappings =======
    -->
  <!--
    first we try to find the controller using the simpleurlmapping, then
    the classname this follows the principal of "convention over
    configuration"
  -->
  <bean
    class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
    <property name="order" value="1" />
    <property name="interceptors">
      <list>
        <!--<ref bean="contentNegociationHandlerInterceptor" /> -->
        <ref bean="localeContextHandlerInterceptor" />
      </list>
    </property>
    <property name="pathMatcher">
      <!--  must match the pathMatcher as set in AnnotationMethodHandlerAdapter -->
      <bean class="eu.etaxonomy.cdm.remote.controller.util.CdmAntPathMatcher" />
    </property>
  </bean>

    <!--
   -->
  <bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="order" value="0" />
    <property name="mappings">
      <props>
        <prop key="/index.do">urlFilenameViewController</prop>
        <prop key="/">welcomeFileViewController</prop>
      </props>
    </property>
  </bean>

  <!--
  ======= HandlerAdapters =======
  -->
  <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
     <property name="pathMatcher">
          <!--  must match the pathMatcher as set in DefaultAnnotationHandlerMapping -->
            <bean class="eu.etaxonomy.cdm.remote.controller.util.CdmAntPathMatcher" />
       </property>
  </bean>

  <!-- needed when using SimpleUrlHandlerMapping 	-->
  <bean
    class="org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter" />


	<!-- 
	======= Remoting =======
	-->
	
<!--	<import resource="classpath:/eu/etaxonomy/cdm/httpInvokerServices.xml"/>-->
<!---->
<!--	<bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">-->
<!--		<property name="order" value="0" />-->
<!--		<property name="mappings">-->
<!--	 -->
	 	<!-- Needed for spring remoting with the http invoker -->
<!--	 	<!-- The configuration of the services is imported from httpInvokerServices.xml -->-->
<!--			<props>-->
<!--				<prop key="/remoting/agent.service">httpAgentService</prop>-->
<!--				<prop key="/remoting/annotation.service">httpAnnotationService</prop>-->
<!--				<prop key="/remoting/auditevent.service">httpAuditEventService</prop>-->
<!--				<prop key="/remoting/classification.service">httpClassificationService</prop>-->
<!--				<prop key="/remoting/collection.service">httpCollectionService</prop>-->
<!--				<prop key="/remoting/common.service">httpCommonService</prop>-->
<!--				<prop key="/remoting/database.service">httpDatabaseService</prop>-->
<!--				<prop key="/remoting/description.service">httpDescriptionService</prop>-->
<!--				<prop key="/remoting/featurenode.service">httpFeatureNodeService</prop>-->
<!--				<prop key="/remoting/featuretree.service">httpFeatureTreeService</prop>-->
<!--				<prop key="/remoting/grantedauthority.service">httpGrantedAuthorityService</prop>-->
<!--				<prop key="/remoting/group.service">httpGroupService</prop>-->
<!--				<prop key="/remoting/identificationkey.service">httpIdentificationKeyService</prop>-->
<!--				<prop key="/remoting/location.service">httpLocationService</prop>-->
<!--				<prop key="/remoting/lsidauthority.service">httpLsidAuthorityService</prop>		-->
<!--				<prop key="/remoting/lsiddata.service">httpLsidDataService</prop>	-->
<!--				<prop key="/remoting/lsidmetadata.service">httpLsidMetadataService</prop>			-->
<!--				<prop key="/remoting/marker.service">httpMarkerService</prop>-->
<!--				<prop key="/remoting/media.service">httpMediaService</prop>-->
<!--				<prop key="/remoting/name.service">httpNameService</prop>-->
<!--				<prop key="/remoting/occurrence.service">httpOccurrenceService</prop>-->
<!--				<prop key="/remoting/polytomouskeynode.service">httpPolytomousKeyNodeService</prop>-->
<!--				<prop key="/remoting/polytomouskey.service">httpPolytomousKeyService</prop>-->
<!--				<prop key="/remoting/reference.service">httpReferenceService</prop>-->
<!--				<prop key="/remoting/service.service">httpServiceService</prop>-->
<!--				<prop key="/remoting/taxonnode.service">httpTaxonNodeService</prop>-->
<!--				<prop key="/remoting/taxon.service">httpTaxonService</prop>-->
<!--				<prop key="/remoting/term.service">httpTermService</prop>-->
<!--				<prop key="/remoting/user.service">httpUserService</prop>-->
<!--				<prop key="/remoting/vocabulary.service">httpVocabularyService</prop>-->
<!--				<prop key="/remoting/authenticationManager.service">httpAuthenticationManager</prop>-->
<!--			</props>-->
<!--		</property>-->
<!--	</bean>-->
<!---->
<!--    -->
<!--    <!-- needed for HTTPInvoker  -->	-->
<!--	<bean class="org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter" />-->
	
	
  <!--
  ======= HandlerInterceptors =======
  -->
  <!--
  <bean id="datasourceContextHandlerInterceptor"
    class="eu.etaxonomy.cdm.remote.controller.interceptor.DatasourceContextHandlerInterceptor" /> -->
  <bean id="localeContextHandlerInterceptor"
    class="eu.etaxonomy.cdm.remote.controller.interceptor.LocaleContextHandlerInterceptor" />

  <!--
   ======= ViewControllers =======
   -->
  <bean id="urlFilenameViewController" class="org.springframework.web.servlet.mvc.UrlFilenameViewController">
  </bean>
  <!--
    The welcome-file-list in the web.xml will is ignored since the
    cdmserver servlet is mapped to the root path [/] So the welcome file
    list is being replaced by a SimpleUrlHandlerMapping on the root path
    [/] which is mapped via this ViewController to the [index] view
  -->
  <bean id="welcomeFileViewController"
    class="org.springframework.web.servlet.mvc.UrlFilenameViewController">
    <property name="suffix">
      <value>index</value>
    </property>
  </bean>


  <!--
    ======= ViewResolver =======
    -->

    <bean id="viewResolverJsp"
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="order" value="0" />
        <property name="prefix" value="/WEB-INF/jsp/" />
        <property name="suffix" value=".jsp" />
        <property name="viewNames">
            <!--
                view names (or name patterns) that can be handled
            -->
            <list>
                <value>index</value>
            </list>
        </property>
    </bean>

  <bean id="oaiViewResolver" class="org.springframework.web.servlet.view.XmlViewResolver">
        <property name="order" value="1"/>
        <property name="location" value="/WEB-INF/oai-views.xml"/>
        <!-- FOR DEBUGING ONLY !!!!
        <property name="cache" value="false"/>
         -->
    </bean>

    <bean id="contentNegotiatingViewResolver" class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
        <property name="order" value="2" />
        <property name="mediaTypes">
           <map>
            <entry key="xml" value="application/xml" />
            <entry key="dc" value="application/xml" />
            <entry key="rdf" value="application/xml" />
            <entry key="rdfxml" value="application/rdf+xml" />
            <entry key="json" value="application/json" />
           </map>
        </property>
        <property name="viewResolvers">
            <list>
          <bean id="xmlTypeViewResolver" class="eu.etaxonomy.cdm.remote.view.PatternViewResolver">
              <property name="location" value="/WEB-INF/xml-views.xml"/>
              <!--
                  turn caching off FOR DEBUGING ONLY !!!!
              <property name="cache" value="false"/>
              -->
          </bean>
          <bean id="jsonTypeViewResolver" class="eu.etaxonomy.cdm.remote.view.PatternViewResolver">
              <property name="location" value="/WEB-INF/json-views.xml"/>
              <!--
                turn caching off FOR DEBUGING ONLY !!!!
              <property name="cache" value="false"/>
              -->
          </bean>
          <bean id="rdfTypeViewResolver" class="eu.etaxonomy.cdm.remote.view.PatternViewResolver">
              <property name="location" value="/WEB-INF/rdf-views.xml"/>
              <!--
                turn caching off FOR DEBUGING ONLY !!!!
              <property name="cache" value="false"/>
              -->
          </bean>
            </list>
        </property>
  </bean>

  <!--
  ======= Exception Handling =======
  -->
  <bean id="exceptionResolver" class="eu.etaxonomy.cdm.remote.exception.CdmExceptionResolver">
  </bean>

  <!--
    ======= Security =======
    -->
<!--    <bean id="basicProcessingFilter" class="org.springframework.security.ui.basicauth.BasicProcessingFilter">-->
<!--		<property name="authenticationManager"><ref bean="authenticationManager"/></property>-->
<!--		<property name="authenticationEntryPoint"><ref bean="authenticationEntryPoint"/></property>-->
<!--	</bean>-->
<!--	<bean id="authenticationEntryPoint" class="org.springframework.security.ui.basicauth.BasicProcessingFilterEntryPoint">-->
<!--		<property name="realmName"><value>Name Of Your Realm</value></property>-->
<!--	</bean>-->

</beans>